<main>
	<div class="movie-wrapper">
		{{#if id}}

		<div class="">
			<div class="grid-x">
				<div class="cell medium-5 small-12 vcenter"><img class="poster center_image" src="https://image.tmdb.org/t/p/original{{poster_path}}">
				</div>


				<div class="cell medium-7">
					<div class="grid-x">
						<div class="cell orange lighten-1">

							<div class="dataTitle vcenter">{{title}} <span class="date">({{release_date}})</span></div>

							

						</div>
					</div>


					<div class="grid-x ">
						<div class="cell">
							<div class="grid-x">
                        <div class="cell vcenter">
								<p><span>Runtime: {{runtime}}</span> <span>Budget: ${{budget}}</span></p>
                  </div>

								<div class="cell vcenter">
									<p>{{#each genres}} <span>{{name}} |</span> {{/each}}</p>
								</div>
							</div>


							<h4 class="vcenter">{{tagline}}</h4>
						</div>
					</div>
					{{#if isLoggedIn}}

					<div class="grid-x ">
						<div class="cell vcenter">
							<div id="buttons">
								<button class="wishlist-button waves-effect waves-light btn-small orange btns" data-id="{{id}}" data-poster="{{poster_path}}" data-title="{{title}}"><i class="material-icons left">add</i>Add to Wishlist</button> <button class="watchedlist-button waves-effect waves-light btn-small orange btns" data-id="{{id}}" data-poster="{{poster_path}}" data-title="{{title}}"><i class="material-icons left">add</i>Add to Watchedlist</button>
							</div>
						</div>
					</div>
					{{/if}}

					<div class="grid-x">
						<div class="cell vcenter">
							<button class="trailer-btn waves-effect waves-light btn-small orange btns" data-title="{{title}}"><i class="material-icons left">play_arrow</i>Watch Trailer</button> <button class="homepage-link waves-effect waves-light btn-small orange btns" data-title="{{title}}"><a href="{{homepage}}"><i class="material-icons left">movie</i>Movie Website</a></button>
						</div>
					</div>


					<div class="summary">
						{{overview}}
					</div>
				</div>
				{{#unless isLoggedIn}}

				<div class="grid-x ">
					<div class="cell medium-6">
						<span>Sign in to add to your lists!</span> <a class="btn" href="/signin">Sign in</a>
					</div>
				</div>
				{{/unless}}
			</div>
			{{else}} Sorry, No Movie Found By This ID {{/if}}
		</div>
	</div>
</main>
<script>
   $(document).ready(function () {

      getRecommendations({{id}}, function(data){
         console.log(data);

         var htmlHolder = "<h2>Similar Movies</h2><div class='swiper-container'><div class='swiper-wrapper'>";
         data.results.map(element => {
            htmlHolder += "<img class='poster swiper-slide' data-id='" + element.id +
            "' src='https://image.tmdb.org/t/p/original" + element.poster_path +
            "' alt='" + element.title + 
            "'>"
         })
         htmlHolder += "</div></div>";

         $("#recommended").html(htmlHolder)
      })

      {{#if isLoggedIn }}
         requestList("watchedList", function (data) {
            data.map(movie => {
               var foundInResults = {{ id }} === parseInt(movie.apiId);

               if (foundInResults) {
                  $("#buttons").children(".watchedlist-button")
                     .text("Remove from Watched List").addClass("orange lighten-1")
               }
            })
         })

         requestList("wishList", function (data) {
            data.map(movie => {
               var foundInResults = {{ id }} === parseInt(movie.apiId);
               if (foundInResults) {
                  $("#buttons").children(".wishlist-button")
                     .text("Remove from Wish List").addClass("orange lighten-1")
               }
            })
         })
      {{/if}}
   });

   $(document).ready(function () {
      var movie = $("#title-to-grab").text();
      var queryURL = "https://www.googleapis.com/youtube/v3/search?part=snippet&q=" + movie + "officialtrailer&h&key=AIzaSyAQkg4udR1aCSogaSzSCYfJbAO0pa_GSx4";
      console.log(queryURL)
      $.ajax({
         url: queryURL,
         method: "GET"
      }).then(function (response) {
         console.log(response.items[0].id.videoId);
         var video = response.items[0].id.videoId;
         var videoURL = "https://www.youtube.com/embed/" + video;
         console.log(videoURL);
         var videoPlay = $("#youtubeVideo").attr("src", videoURL);
      });
   });
   
</script>
